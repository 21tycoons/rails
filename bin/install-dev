#!/usr/bin/env bash

# Build and install all gems as the version specified in RAILS_VERSION for local testing.
VERSION=$(cat RAILS_VERSION)

# Install gems in order of dependency
gems=("activesupport" "activemodel" "activerecord" "actionpack" "actionview" "activejob" "actioncable" "activestorage" "actiontext" "actionmailbox" "actionmailer" "railties")

for gem in "${gems[@]}"; do
  if [ -d "$gem" ]; then
    cd "$gem"
    gem build "$gem.gemspec"
    gem install --no-document "$gem-$VERSION.gem"
    rm "$gem-$VERSION.gem"
    cd -
  fi
done

# Install the master gem
gem build rails.gemspec
gem install --no-document rails-$VERSION.gem
rm rails-$VERSION.gem
